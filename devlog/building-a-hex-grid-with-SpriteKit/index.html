<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=0.7"><!-- Begin Jekyll SEO tag v2.7.1 -->
<meta name="generator" content="Jekyll v3.8.7" />
<meta property="og:title" content="Building a hex grid with SpriteKit" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Kicking off our game development by creating a hex grid" />
<meta property="og:description" content="Kicking off our game development by creating a hex grid" />
<link rel="canonical" href="https://dodogames.io/devlog/building-a-hex-grid-with-SpriteKit/" />
<meta property="og:url" content="https://dodogames.io/devlog/building-a-hex-grid-with-SpriteKit/" />
<meta property="og:site_name" content="Dodo Games" />
<meta property="og:image" content="https://dodogames.s3.eu-west-2.amazonaws.com/devlog/2021/first-rendered-grid.jpg" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2021-05-06T12:30:00+01:00" />
<meta name="twitter:card" content="summary_large_image" />
<meta property="twitter:image" content="https://dodogames.s3.eu-west-2.amazonaws.com/devlog/2021/first-rendered-grid.jpg" />
<meta property="twitter:title" content="Building a hex grid with SpriteKit" />
<meta name="twitter:site" content="@bendodson" />
<script type="application/ld+json">
{"dateModified":"2021-05-06T12:30:00+01:00","datePublished":"2021-05-06T12:30:00+01:00","mainEntityOfPage":{"@type":"WebPage","@id":"https://dodogames.io/devlog/building-a-hex-grid-with-SpriteKit/"},"url":"https://dodogames.io/devlog/building-a-hex-grid-with-SpriteKit/","image":"https://dodogames.s3.eu-west-2.amazonaws.com/devlog/2021/first-rendered-grid.jpg","description":"Kicking off our game development by creating a hex grid","headline":"Building a hex grid with SpriteKit","@type":"BlogPosting","@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->
<title>Building a hex grid with SpriteKit — Dodo Games</title>
  <link rel="stylesheet" href="/assets/main.css"><link type="application/atom+xml" rel="alternate" href="https://dodogames.io/feed.xml" title="Dodo Games" /><link rel="apple-touch-icon" sizes="57x57" href="/apple-icon-57x57.png">
  <link rel="apple-touch-icon" sizes="60x60" href="/apple-icon-60x60.png">
  <link rel="apple-touch-icon" sizes="72x72" href="/apple-icon-72x72.png">
  <link rel="apple-touch-icon" sizes="76x76" href="/apple-icon-76x76.png">
  <link rel="apple-touch-icon" sizes="114x114" href="/apple-icon-114x114.png">
  <link rel="apple-touch-icon" sizes="120x120" href="/apple-icon-120x120.png">
  <link rel="apple-touch-icon" sizes="144x144" href="/apple-icon-144x144.png">
  <link rel="apple-touch-icon" sizes="152x152" href="/apple-icon-152x152.png">
  <link rel="apple-touch-icon" sizes="180x180" href="/apple-icon-180x180.png">
  <link rel="icon" type="image/png" sizes="192x192"  href="/android-icon-192x192.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="96x96" href="/favicon-96x96.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
  <link rel="manifest" href="/manifest.json">
  <meta name="msapplication-TileColor" content="#ffffff">
  <meta name="msapplication-TileImage" content="/ms-icon-144x144.png">
  <meta name="theme-color" content="#ffffff">
</head>
<body><header class="site-header" role="banner">

  <div class="wrapper"><a class="site-title-container" rel="author" href="/">
      <span class="site-title" >Dodo Games</span>
      <span class="site-subtitle">Indie games for iPhone, iPad, and Apple TV</span>
    </a>

    <nav class="site-nav">
      <input type="checkbox" id="nav-trigger" class="nav-trigger" />
      <label for="nav-trigger">
        <span class="menu-icon">
          <svg viewBox="0 0 18 15" width="18px" height="15px">
            <path d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.032C17.335,0,18,0.665,18,1.484L18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.032C17.335,6.031,18,6.696,18,7.516L18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516l0,0c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,12.031,18,12.695,18,13.516L18,13.516z"/>
          </svg>
        </span>
      </label>

      <div class="trigger">
        <a class="page-link" href="/games/">Games</a>
        <a class="page-link" href="/devlog/">Development Log</a>
        <a class="page-link" href="/about/">About</a>
      </div>
    </nav>

  </div>
</header>
<main class="page-content" aria-label="Content">
      <div class="wrapper">
        <article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    <h1 class="post-title p-name" itemprop="name headline">Building a hex grid with SpriteKit</h1>
    <p class="post-meta">
      <time class="dt-published" datetime="2021-05-06T12:30:00+01:00" itemprop="datePublished">
        6th May 2021
      </time></p>
  </header>

  <div class="post-content e-content" itemprop="articleBody">
    <p>A large portion of the gameplay of <em>The Forest</em> will take place on a hex grid akin to board games like <em>Terraforming Mars</em>, <em>Gloomhaven</em>, and <em>1861: The Railways of the Russian Empire</em><sup id="fnref:railways"><a href="#fn:railways" class="footnote">1</a></sup>. The majority of the board will be tiles that are never interacted with; these will just display some trees and will help give a sense of scale to the area. The remainder will be interactive tiles that can be flipped over to chart your course through the woods. In my head, I assumed I’d need to render each tile manually by looping through every column and every row and drawing the tile with a bit of offset on each row so they stack neatly. It turns out that SpriteKit already has this covered for us with <code class="highlighter-rouge">SKTileMapNode</code>.</p>

<p>The idea behind the <code class="highlighter-rouge">SKTileMapNode</code> is to draw background maps akin to something you’d see in the 2D Zelda games. For example, you might have some grass that turns into a desert and has a river running through. This would typically be generated in advance and Apple provides a way to create these kinds of maps using the SpriteKit Scene Editor within Xcode<sup id="fnref:wysiwyg"><a href="#fn:wysiwyg" class="footnote">2</a></sup>. They also provide a way to procedurally generate maps if you want to create something randomised including adjacency rules so you can specify complex ideas like how a shoreline should work<sup id="fnref:hackingtilemap"><a href="#fn:hackingtilemap" class="footnote">3</a></sup>.</p>

<p>I don’t need anything quite that sophisticated but this does work well in terms of generating a random distribution of background tree tiles for my map. To begin with, I have 10 different images for the hexes I want to generate as my base map all courtesy of the excellent <a href="https://stevencolling.itch.io/isle-of-lore-2-hex-tiles-regular">Isle of Lore 2 Hex Tiles Regular</a> set by <a href="https://www.stevencolling.com">Steven Colling</a>.</p>

<div class="gofigure">
    <img src="https://dodogames.s3.eu-west-2.amazonaws.com/devlog/2021/hex-grid-background-tiles.png" alt="10 dense forest tiles" />
    <figure>10 dense forest tiles. They are all slightly different.</figure>
</div>

<p>These images can all be placed into a SpriteKit Tile Set file within Xcode where we can define that they are of a “Hexagonal Pointy” type<sup id="fnref:skstype"><a href="#fn:skstype" class="footnote">4</a></sup>. With that done, it’s a simple case of adding the map to our scene:</p>

<figure class="highlight"><pre><code class="language-swift" data-lang="swift"><span class="k">guard</span> <span class="k">let</span> <span class="nv">tileSet</span> <span class="o">=</span> <span class="kt">SKTileSet</span><span class="p">(</span><span class="nv">named</span><span class="p">:</span> <span class="s">"Forest Tiles"</span><span class="p">)</span> <span class="k">else</span> <span class="p">{</span>
    <span class="nf">fatalError</span><span class="p">(</span><span class="s">"Could not find Forest Tiles set"</span><span class="p">)</span>
<span class="p">}</span>
<span class="k">let</span> <span class="nv">map</span> <span class="o">=</span> <span class="kt">SKTileMapNode</span><span class="p">(</span><span class="nv">tileSet</span><span class="p">:</span> <span class="n">tileSet</span><span class="p">,</span> <span class="mi">8</span><span class="p">:</span> <span class="n">columns</span><span class="p">,</span> <span class="nv">rows</span><span class="p">:</span> <span class="mi">8</span><span class="p">,</span> <span class="nv">tileSize</span><span class="p">:</span> <span class="o">.</span><span class="nf">init</span><span class="p">(</span><span class="nv">width</span><span class="p">:</span> <span class="mi">210</span><span class="p">,</span> <span class="nv">height</span><span class="p">:</span> <span class="mi">210</span><span class="p">))</span>
<span class="n">map</span><span class="o">.</span><span class="nf">fill</span><span class="p">(</span><span class="nv">with</span><span class="p">:</span> <span class="n">tileSet</span><span class="o">.</span><span class="n">tileGroups</span><span class="o">.</span><span class="n">first</span><span class="p">)</span>
<span class="n">map</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">"background"</span>
<span class="n">map</span><span class="o">.</span><span class="n">zPosition</span> <span class="o">=</span> <span class="mi">0</span>
<span class="nf">addChild</span><span class="p">(</span><span class="n">map</span><span class="p">)</span></code></pre></figure>

<p>When creating the <code class="highlighter-rouge">SKTileMapNode</code> we tell it which <code class="highlighter-rouge">SKTileSet</code> to use (based on the *.sks file we created earlier), the number of columns and rows we want, and the size each tile should be displayed at. We then tell the map to fill using the tile set which will generate the map using a random mix of the 10 tiles we made available. Finally we name the node for use later on, set the zPosition to be 0 so it sits below everything, and add it to the scene. The end result is a fixed hex grid with a random distribution of tree images:</p>

<div class="gofigure">
    <img src="https://dodogames.s3.eu-west-2.amazonaws.com/devlog/2021/first-rendered-grid.jpg" alt="A hex grid with randomly distributed forest tiles" />
    <figure>A hex grid with randomly distributed forest tiles.</figure>
</div>

<p>The main advantage to this method (beyond concise code) is that it is also far more efficient as it is a single node within SpriteKit; adding each tile manually would result in a node for every tile. However, we can’t interact with this grid so we need to do some more work in order to add our actual game tiles.</p>

<p>Fortunately, it’s fairly easy to ascertain where we are on the tile map as there is a <code class="highlighter-rouge">centerOfTile(atColumn column: Int, row: Int)</code> method which gives us a <code class="highlighter-rouge">CGPoint</code> for the center of a defined tile. All I need to do is choose where I want my real tiles to go (by way of a grid reference) and then add them to the scene using the position that the tile map returns for that particular reference.</p>

<p>I’m planning on having tiles flip over when you interact with them which adds an extra wrinkle as you’ll be able to see this base tile map behind the flip animation. To do that, I need to ensure that when I add a tile on top of the map that I also alter the tile group to use a blank hex that is the same colour as the background of the scene:</p>

<figure class="highlight"><pre><code class="language-swift" data-lang="swift"><span class="k">let</span> <span class="nv">definition</span> <span class="o">=</span> <span class="kt">SKTileDefinition</span><span class="p">(</span><span class="nv">texture</span><span class="p">:</span> <span class="kt">SKTexture</span><span class="p">(</span><span class="nv">imageNamed</span><span class="p">:</span> <span class="s">"hex_background"</span><span class="p">),</span> <span class="nv">size</span><span class="p">:</span> <span class="o">.</span><span class="nf">init</span><span class="p">(</span><span class="nv">width</span><span class="p">:</span> <span class="mi">210</span><span class="p">,</span> <span class="nv">height</span><span class="p">:</span> <span class="mi">210</span><span class="p">))</span>
<span class="k">let</span> <span class="nv">group</span> <span class="o">=</span> <span class="kt">SKTileGroup</span><span class="p">(</span><span class="nv">tileDefinition</span><span class="p">:</span> <span class="n">definition</span><span class="p">)</span>
<span class="n">map</span><span class="o">.</span><span class="nf">setTileGroup</span><span class="p">(</span><span class="n">group</span><span class="p">,</span> <span class="nv">forColumn</span><span class="p">:</span> <span class="n">column</span><span class="p">,</span> <span class="nv">row</span><span class="p">:</span> <span class="n">row</span><span class="p">)</span></code></pre></figure>

<p>After playing around with light nodes and overlays (which I’ll detail in a later post), a test rendering looks something like this:</p>

<div class="gofigure">
    <img src="https://dodogames.s3.eu-west-2.amazonaws.com/devlog/2021/hex-flipping.gif" alt="Flipping a hex tile" />
</div>

<p>Whilst the scene has lighting and multiple visible hexes<sup id="fnref:lightingarticle"><a href="#fn:lightingarticle" class="footnote">5</a></sup>, it’s really only made up of the six tiles you see on top (which look like background tiles until an animation appears to make them flip) and the background tile map with a few blank hexes strategically placed. I’m very happy with how easy it was to get started with a hex board in SpriteKit and will now be moving on to the process of generating the various tiles that will be placed on the board.</p>

<div class="footnotes">
  <ol>
    <li id="fn:railways">
      <p>A personal favourite of mine. Trains? Stock markets? The ability to screw over your opponent, perform a hostile takeover of their company, then drive it into the ground for personal gain? Perfection. 👨🏻‍🍳🤌🏻 <a href="#fnref:railways" class="reversefootnote">&#8617;&#65038;</a></p>
    </li>
    <li id="fn:wysiwyg">
      <p>It’s a wysiwyg interface suitable for a designer to create a map with no programming knowledge. Check out <a href="https://theliquidfire.com/2018/02/12/spritekit-tile-maps-intro/">this tutorial from The Liquid Fire</a> to see it in action. <a href="#fnref:wysiwyg" class="reversefootnote">&#8617;&#65038;</a></p>
    </li>
    <li id="fn:hackingtilemap">
      <p>For a deep dive, check out <a href="https://www.hackingwithswift.com/example-code/games/how-to-create-a-random-terrain-tile-map-using-sktilemapnode-and-gkperlinnoisesource">this tutorial</a> from Hacking with Swift that shows you how to create a procedurally generated map with water, grass, and sand. <a href="#fnref:hackingtilemap" class="reversefootnote">&#8617;&#65038;</a></p>
    </li>
    <li id="fn:skstype">
      <p>Other choices include “Grid”, “Isometric”, and “Hexagonal Flat”. <a href="#fnref:skstype" class="reversefootnote">&#8617;&#65038;</a></p>
    </li>
    <li id="fn:lightingarticle">
      <p>I forgot to take an animation when I originally built this feature so had to use one once other work had already been done. You can learn about the lighting in my <a href="/devlog/sklightnode-and-normal-maps/">next article</a>. <a href="#fnref:lightingarticle" class="reversefootnote">&#8617;&#65038;</a></p>
    </li>
  </ol>
</div>

  </div>

  <a class="u-url" href="/devlog/building-a-hex-grid-with-SpriteKit/" hidden></a>
</article>

      </div>
    </main><footer class="site-footer h-card">
  <data class="u-url" href="/"></data>

  <div class="wrapper">

    <div class="footer-col-wrapper">
      <div class="footer-col footer-col-1">
        <ul class="contact-list">
          <li class="p-name">Twitter</li>
          <li><a href="https://twitter.com/bendodson">@BenDodson</a></li>
        </ul>
      </div>

      <div class="footer-col footer-col-2">

      </div>

      <div class="footer-col footer-col-3">
        <ul class="contact-list">
          <li class="p-name">Email</li>
          <li><a class="u-email" href="mailto:ben@bendodson.com">ben@bendodson.com</a></li>
        </ul>
      </div>
      
    </div>

  </div>

</footer>
</body>

</html>
